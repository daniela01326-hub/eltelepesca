<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Producto ‚Äî eltelepesca</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-800" x-data="app()" x-init="init()">
  <main class="max-w-5xl mx-auto px-4 py-6">
    <template x-if="loading"><p>Cargando‚Ä¶</p></template>
    <template x-if="product">
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-white rounded-2xl shadow-sm border overflow-hidden relative">
          <img :src="product.imagen || ('https://picsum.photos/seed/'+product.__id+'/1200/900')"
               class="w-full h-96 object-cover" :class="{'grayscale opacity-70': (product.stock_num||0) <= 0}">
          <div x-show="(product.stock_num||0) <= 0"
               class="absolute -right-8 top-3 rotate-45 bg-rose-600 text-white text-xs font-bold px-10 py-1 shadow">
            SIN STOCK
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border p-5">
          <h1 class="text-2xl font-bold" x-text="product.nombre"></h1>
          <div class="mt-3 space-y-1">
            <div class="text-2xl font-bold text-emerald-700" x-text="fmtPrice(product.precio_transfer) + ' (Transferencia)'"></div>
            <div class="text-lg font-semibold text-sky-700" x-text="fmtPrice(product.precio_mp) + ' (Mercado Pago)'"></div>
          </div>
          <p class="mt-4 text-slate-700" x-text="product.descripcion || 'Sin descripci√≥n'"></p>
        </div>
      </div>
    </template>
  </main>

  <!-- Acerca + Ubicaci√≥n -->
  <section class="max-w-5xl mx-auto px-4">
    <div class="bg-white rounded-2xl shadow-sm border p-6">
      <h2 class="text-xl font-semibold">Acerca de la tienda</h2>
      <p class="mt-3 text-slate-700">Casa de pesca con una trayectoria de 45 a√±os...</p>
      <p class="mt-3 text-slate-700">
        üìç <a href="https://www.google.com/maps/place/el+tele+ivanstg/@-34.6899038,-58.3303484,17z" class="underline" target="_blank">
          Emilio Zola & Darwin, Villa Dom√≠nico, Provincia de Buenos Aires, Argentina
        </a>
      </p>
    </div>
  </section>

<script>
function app(){
  const MP_RATE = 1.10;
  return {
    product:null, id:null, loading:true,
    async init(){
      this.id = new URLSearchParams(location.search).get('id');
      const res = await fetch('data/productos.xlsx'); if(!res.ok){ this.loading=false; return; }
      const buf = await res.arrayBuffer(); const wb = XLSX.read(buf,{type:'array'});
      const pick=(o,ks)=>{ for(const k of ks){ if(o[k]!=null&&o[k]!=='') return o[k]; } };
      const num=(v)=>{ if(typeof v==='number') return v; if(v==null) return NaN; let s=String(v).trim().replace(/[^0-9,.-]/g,''); if(s.includes(',')){ s=s.replace(/\./g,''); s=s.replace(/,/g,'.'); } const n=Number(s); return isFinite(n)?n:NaN; };
      for(const sheetName of wb.SheetNames){
        const rows = XLSX.utils.sheet_to_json(wb.Sheets[sheetName],{defval:'',raw:true});
        let rowId=1;
        for(const r of rows){
          const row=Object.fromEntries(Object.entries(r).map(([k,v])=>[String(k).toLowerCase().trim(), v]));
          const nombre = pick(row,['nombre','producto','articulo','descri','detalle','item']);
          const precioRaw = pick(row,['precio','$','importe','valor','p. lista','precio feria','precio unitario']);
          const desc = pick(row,['descripcion','detalle','observ']);
          const stockRaw = pick(row,['stock','disp']);
          const imagen = pick(row,['imagen','foto','url']);
          const base = num(precioRaw);
          const stock_num = (function(){ if(!stockRaw) return 0; const s=String(stockRaw).replace(/[^\d-]/g,''); const n=Number(s); return Number.isFinite(n)?n:0; })();
          if(nombre && !isNaN(base)){
            const rec = { __id: sheetName+'-'+(rowId++), nombre: String(nombre).trim(),
              precio_transfer: Math.round(base), precio_mp: Math.round(base*MP_RATE),
              descripcion: String(desc||'').trim(), stock_num,
              imagen: String(imagen||'').trim() };
            if (rec.__id === this.id){ this.product = rec; this.loading=false; return; }
          }
        }
      }
      this.loading=false;
    },
    fmtPrice(v){ return Number(v||0).toLocaleString('es-AR',{style:'currency', currency:'ARS', maximumFractionDigits:0}); }
  }
}
</script>
</body>
</html>
